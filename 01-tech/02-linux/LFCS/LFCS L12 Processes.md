# Linux Foundation Certified System Administrator (LFCS)

## Lesson 12 Процессы

#### Основы

* При запуске ядра запускается процесс `systemd`
* он порождает другие процессы (`crond`, `rsyslog`)
* процессы связаны отношением родительский-дочерний
* прекрашение родительского вызывает прекращение дочерних
* процесс может порождать другие процессы или потоки

#### Jobs control

* Job - это процесс, когда про него говорят в контексте управления (напр. в консоли)
* `Ctrl + C` - прерывает процесс, `Ctrl + Z` - останавливает
* остановленный процесс можно продолжить `bg` - запускает последний остановленный процесс на заднем фоне
* можно сразу в фоне `... &`
* `jobs` выводит список запущенных заданий
* `fg` - переводит последнее фоновое задание в активное
* `fg №` - переводит задание с номером №

#### Команда top

* Инфо о запушенных процессах
* `top – 17:15:19 up 32 days, 18:24, 6 users` время работы + кол-во пользователей всего
* `load average: 0,00, 0,01, 0,05` - средняя загрузка за последние 1, 5, 15 мин (кол-во процессов ожидающих очереди)
* `Tasks: 119 total, 1 running, 118 sleeping, 0 stopped, 0 zombie` 
    - total - общее кол-во процессов
    - running - кол-во запущенных
    - sleeping - работающих в фоновом режиме
    - stopped - остановленные (нехорошая ситуация)
    - zombie - дочерние процессы, родитель которых отсутствует (нехорошая ситуация)
* `Cpu(s): 0.0%us, 0.0%sy, 0.0%ni, 99.9%id, 0.0%wa, ...`
    - статистика по использованию процессора
    - `us` - процент процессного времени на пользовательские задачи
    - `sy` - на работу системы
    - `ni` - на пользовательские задачи, приоритет которых был изменен спец. командами
    - `id` - время простоя
    - `wa` - ожидание завершения операций ввода/вывода (высокие значения - проблемы с дисками)
    - в сумме все значения должны давать 100%
* `Mem:  2005100k total, 32256k used, 1900240 free, 15820 buffers`
    - по памяти (аналог - команда `free`)
    - `total` - всего
    - `used` - занято процессами
    - `free` - свободно
    - `buffers` - занято под буферы для чтения с дисков
* Таблица:
    - колонка `S` - статус процесса (Sleeping, Zombie, Running)
    - `Shift + F` - настройка состава колонок, сортировка
    - `top -u <Имя пользователя>` - отбор по пользователю

#### Команда ps

* `ps` - процессы текущего пользователя
* `ps aux` - процессы всех пользователей
* `ps -ef` - процессы с родительскими, процессы в [] - системные
* `ps -e -o pid, args --forest` - выводит аргументы запуска + отображение дерева подчиненности
* `ps aux --sort <имя колонки>` - сортировка по колонке 

#### Изменение приоритета

* из команды `top`
    - `r` + pid процесса + значение ni (-20 .. +19)
    - введенное значение добавляется к текущему PR
    - чем ниже -тем выше приоритет
    - обычный пользователь может только понижать приоритет (устанавливая положительные ni)

* команда `nice`
    - запуск процесса с заданным значением ni
    - `nice -n 5  <команда>`
* команда `renice`
    - изменяет приоритет
    - `renice -n 5 <pid>`


#### Работа с сигналами

* каждому процессу можно отправлять различные сигналы
    - напр. SIGNKILL (9), SIGNTERM (15)
    - полный список см. `man 7 signal`
    - SIGNTERM - принуждает процесс заверщить работу, давая время на закрытие ресурсов
    - SIGNKILL - ОС завершает процесс сразу (осторожно использовать)
* посылка сигнала через интерфейс `top`
    - `k`
    - ввести pid
    - ввести код сигнала

* команда `kill`
    - работает с pid
    `kill -<код сигнала> <pid>`
* команда `killall`
    - работает с именами
