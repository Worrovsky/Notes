# Linux Foundation Certified System Administrator (LFCS)

## Lesson 9 SSH

#### Конфигурация

* Расположена в 
    - `/etc/ssh/ssh_config` - конфигурация клиента
        + разрещает проброс подключений `ForwardAgent yes`
        + запуск приложений с графическим интерфейсом `ForwardX11 yes`
    - `/etc/ssh/sshd_config` - конфигурация сервера
        + настраивается порт (22 по умолчанию)
        + если сервер виден из внешней сети рекомендуется `PermitRootLogin no`
        + лучше авторизоваться через ключи и запретить авторизацию по паролю `PasswordAuthentication no`

#### Управление службой SSH

* системный процесс **sshd**
* `systemctl status sshd`
    - должна быть пометка active
* остановка / запуск
    - `systemctl stop sshd`
    - `systemctl start sshd`
* перезапуск (после изменения конфигурации) `systemctl restart sshd`
* отключение / включение запуска службы при загрузке системы
    - `systemctl disable sshd`
    - `systemctl enable sshd`

#### Подключение к серверу по SSH

* `ssh <ip-адрес>`
    - сработает если не на сервере разрешено root-подключение по ssh
* `ssh <login>@<ip-адрес>`
    - подключение от имени пользвателя
* `ssh -X <login>@<ip-адрес>`
    - подключение с возможность запуска графических приложений
* После подключения в `~/.ssh/known_hosts` сохраняется отпечаток подключения (fingerprint)

#### Подключение с помощью ключей

* `ssh-keygen` создает публичный (id_rsa.pub) и приватный ключ (id_rsa) на клиенте
* для приватного ключа можно указать пароль
* копируем публичный ключ на сервер `ssh-copy-id login@ip` или `ssh-copy-id -i <файл ключа> login@ip`
* этим изменяем файл `~/.ssh/authorized_keys`
* можно просто редактором открыть и вставить данные из `id_rsa.pub`

#### Копирование файлов `scp`

* аналог `cp`
* для указания пути на удаленный хост используется префикс `ip-адрес:`
* `scp /etc/hosts 192.34.52.3:/tmp`
* `scp 192.34.52.3:/etc/passwd .`