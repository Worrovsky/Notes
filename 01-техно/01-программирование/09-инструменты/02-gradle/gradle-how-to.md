# Основы
[Gradle Croovy Primer](https://docs.gradle.org/current/userguide/groovy_build_script_primer.html)

## Project object

Неявный объект, всегда есть на верхнем уровне build-скрипта (не внутри `{}`)

## Свойства

`<obj>.<name>`              получение свойства
`<obj>.<name> = <value>`    установка свойства
`"$<name>"`                 подстановка значения свойства в строку
`"${<obj>.<name>}"`         аналогично

Если имя свойства не полностью квалифицировано (не `<a>.<b>`), это может быть:

* экземпляр task
* свойство `Project`
* **внешнее свойство**, определенное внутри проекта
* свойство неявного объекта внутри **блока**
* **локальная переменная**, определенная ранее

Подключаемые плагины добавляют свои свойства в `Project`

для свойств существуют методы доступа 
`version` / `project.getVersion()` / `project.version`
`version = "1"` / `project.setVersion("1")` / `project.version = "1"`

## Методы

`<obj>.<name>()`            метод без параметров, скобки обязательны
`<obj>.<name>(<p1>, <p2>)`  метод с параметрами
`<obj>.<name> <p1>, <p2>`   метод c параметрами, можно без скобок

для простоты можно решить всегда использовать скобки

методы также могут быть не полностью квалифицированы

Конвенция: если есть свойство-коллекция и метод с таким именем, этот метод добавляет значение в коллекцию

## Блоки

Блоки как методы с особым типом последнего аргумента

`<obj>.<name> { ... }`
`<obj>.<name>(<arg1>, <arg2>) { ... }`

используются для конфигурации множественных аспектов проекта

Особенности:

* реализованы как методы с особой сигнатурой
* могут изменять (делегировать) цель неквалифицированных методов и свойств

### Сигнатуры блоков

? как по документации / API понять что метод является блоком ?

Метод является блоком если:

* имеет хотя бы один аргумент
* тип последнего аргумента **groovy.lang.Closure** или **org.gradle.api.Action**

напр. Project.copy(Action), поэтому можно 

    copy {
        into "$buildDir/tmp"
        from "my-resource"
    }

### Делегирование

В примере используются неквалифицированные имена свойств / методов.

Проверяем по правилам: `copy`, `buildDir` - это от Project
`into`, `from` в Project нет

Нужно определять по типу переменной блока. Если это Action - смотрим на тип его параметра. Если это Closure - будет явно описано в документации

## Локальные переменные

`def <name> = <value>`      без указания типа
`<type> <name> = <value>`   с явным указанием типа

Не следует использовать в корне проекта в качестве псевдосвойств Project



# Работа с файлами

[docs](https://docs.gradle.org/current/userguide/working_with_files.html)

## Копирование файла

создаем экземпляр встроенного task `Copy` и настраиваем источник / приемник

    task copyReport(type: Copy) {
        from file("$buildDir/reports/1.pdf")
        into file("$buildDir/out")
    }

здесь `file` - метод `Project` для получения, создания файлов относительно корня проекта. `Copy` - task из `Project`

можно без явного создания объекта `file`: `.. from "buildDir/reports/1.pdf" ..`

## Копирование нескольких файлов

вариант 1: перечислить через зпт
    
    from "src/1.txt", "src/2.txt"

вариант 2: через шаблоны `include`, `exclude`
шаблоны:
    `*` - без вложений, только текущая директория
    `**/*` - с поиском внутри вложенных директорий, копирует директории

    from "scr"
    include "*.java"

## Копирование иерархии директорий

если в `from` указана директория, копируется все ее содержимое с иерархией, но без самой директории
если нужно копировать и саму директорию можно через директорию уровня выше + `include`:

    from("$buildDir") {
        include "reports/**"
    }

## Архивирование

создаем экземпляр task `Zip`

    task packDistr(type: Zip) {
        archiveFileName = "my-distr.zip"
        destinationDirectory = file("$buildDir/dist")
        from "$buildDir/toArchive"
    }

все параметры обязательны, но обычно в проекте используется плагин **base**, где эти значения указаны и явно их не задают

## Разархивирование

## Создание директорий

метод `mkdir` объект `Project`

    task ensDirectory {
        doLast {
            mkdir "images"
        }
    }

создает все промежуточные в иерархии, если существуют - ничего не делает

## Перемещение файлов

встроенных нет, можно использовать `ant.move`
не рекомендуется, лучше копирование

## Переименование при копировании

как часть task **Copy**
можно через RegExp

    from ...
    into ..
    rename `(.+)-staging(.+)', '$1$2'

или через closure

    ...
    rename (String filename -> return filename[0..7])
    // первые 8 символов

## Удаление файлов / директорий

Через метод `delete()` объекта `Project` 
или через задачу `Delete`